// Generated by CoffeeScript 1.7.1
var application, async, citizen, express, region, router;

async = require('async');

express = require('express');

router = express.Router();

citizen = require('../user/citizen');

application = require('../passport/application');

region = require('../passport/region');

router.all('/profile', function(req, res, next) {
  res.locals.attr_list = citizen.attr_list;
  application.getAllForEmail(req.session.user.email, function(err, application) {
    var app;
    if (err) {
      return next(err);
    }
    return res.locals.applications = (function() {
      var _i, _len, _results;
      _results = [];
      for (_i = 0, _len = applications.length; _i < _len; _i++) {
        app = applications[_i];
        _results.push(application.expandValueUsingMap(app));
      }
      return _results;
    })();
  });
});

router.all('/application', function(req, res, next) {
  res.locals.attr_list = application.attr_list;
  region.getRegions(function(err, regions) {
    if (err) {
      return next(err);
    }
    res.locals.regions = regions;
    next();
  });
});

module.exports = router;
