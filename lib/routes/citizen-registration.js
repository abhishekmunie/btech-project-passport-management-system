// Generated by CoffeeScript 1.7.1
var citizen, express, router;

express = require('express');

router = express.Router();

citizen = require('../user/citizen');

router.post('/', function(req, res, next) {
  var newCitizen;
  newCitizen = new citizen.Citizen('req', req);
  console.log(newCitizen);
  citizen.addCitizen(newCitizen, function(err) {
    if (err) {
      res.locals.error = err;
      console.error(err);
      next();
      return;
    }
    res.redirect(req.url.replace(/^\//, "/dashboard"));
  });
});

router.all('/', function(req, res, next) {
  res.locals.attr_list = citizen.attr_list;
  res.locals.today = new Date().toISOString().slice(0, 10);
  next();
});

module.exports = router;
